<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css"></link>
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="http://code.createjs.com/easeljs-0.7.0.min.js"></script>
  <script src="http://code.createjs.com/tweenjs-0.5.1.min.js"></script>
  <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="js/ball.js"></script>
  <script src="js/canvas.js"></script>
  <script src="js/events.js"></script>
  <script src="js/bar.js"></script>
  <script src="js/text.js"></script>
  <script>
  
  var init = function() {
    CANVAS.init("doodle");

    text.countdown();

    ball.init("#FFFFFF");
    setTimeout(function(){    
      CANVAS.addShape(ball.shape);
      ball.setInitialPosition(CANVAS.width/2, CANVAS.height/2);  
      ball.setInitialSpeed();
    }, 3000);

    left_bar = new bar();
    left_bar.init("#FFFFFF", 1);
    CANVAS.addShape(left_bar.shape);
    left_bar.setInitialPosition(25/CANVAS.stage.scaleX, CANVAS.height/2 - left_bar.height / CANVAS.stage.scaleY / 2);

    right_bar = new bar();
    right_bar.init("#FFFFFF", 1);
    CANVAS.addShape(right_bar.shape);
    right_bar.setInitialPosition(CANVAS.width - right_bar.width/CANVAS.stage.scaleX - 25/CANVAS.stage.scaleX, CANVAS.height/2 - right_bar.height / CANVAS.stage.scaleY / 2);

    CANVAS.addTouch();

    CANVAS.record = 5;
    CANVAS.score = 0;

    addCallbacks();
  }

  var setScore = function(){
    $('#score').text(CANVAS.score);
    $('#record').text(CANVAS.record);
  }

  var tick = function() {

    left_bar.update(CANVAS);
    left_bar.draw();

    right_bar.update(CANVAS);
    right_bar.draw();

    ball.update(CANVAS, left_bar, right_bar);
    ball.draw();  

    CANVAS.update();
    setScore();
  };

  var addCallbacks = function(){
    document.onkeydown = handleKeyDown;
    document.onkeyup = handleKeyUp;

    CANVAS.stage.on("stagemousedown", function(event){mouseDown(event);});
    CANVAS.stage.on("stagemousemove", function(event){mouseMove(event);});
    CANVAS.stage.on("stagemouseup", function(event){mouseUp(event);});
    document.onmouseup = mouseUp;

    createjs.Ticker.setFPS(30);
    createjs.Ticker.addEventListener("tick", tick);
  };

</script>
</head>
<body onLoad="init();">
  <div id="container"> 
    <img id="background" src="img/background.png">
    <canvas id="doodle" width="1500" height="900"></canvas>
    <script>
      var windowW = $( window ).width();
      var windowH = $( window ).height();

      $("#container").width(windowW - 200);
      $("#container").height(windowH - 200);


      if ((windowW - 200) * 850 / 1280 <= windowH - 200){
        $("#background").width(windowW - 200);
        $("#background").css("margin-top", (windowH - 200 - $("#background").height())/2);
      }
      else {
        $("#background").height(windowH - 200);
        $("#background").css("margin-left", (windowW - 200 - $("#background").width())/2);
      }

      $("#doodle").width(windowW - 200);
      $("#doodle").height(windowH - 200);

    </script>
  </div>
  <div id="footer" class="responsive">
    <div id="recordtxt"><span>Record:</span><span id ="record"></span></div> 
    <div id="scoretxt"><span>Score:</span><span id ="score"></span></div>
    <div id="sharefb"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F95.85.12.111%2Fpullandpong" target="_blank">Share</a></div>
  </div>
</body>
</html>