<!DOCTYPE html>
<html>
<head>
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="http://code.createjs.com/easeljs-0.7.0.min.js"></script>
  <script src="http://code.createjs.com/tweenjs-0.5.1.min.js"></script>
  <link rel="stylesheet" href="style.css"></link>
  <script>
    var PM = {};

    PM.barWidth = 15;
    PM.barHeight = 80;
    PM.ballDiameter = 30;

    PM.ballMoveX = 5;
    PM.ballMoveY = 5;
    PM.barMove = 10;

    PM.gameOver = false;

    function init() {
      PM.getDoodleSize("doodle");
      PM.addBarLeft("#FFFFFF");
      PM.addBarRight("#FFFFFF");
      PM.addBall("#FF0000");

      PM.makeThingsMove();
    }

    PM.getDoodleSize = function(canvas_id) {
      PM.stage = new createjs.Stage(canvas_id);
      PM.doodleWidth = parseInt($("#" + canvas_id).css("width"));
      PM.doodleHeight = parseInt($("#" + canvas_id).css("height"));
    };

    PM.addBarLeft = function(barcolor) {
      PM.barLeft = new createjs.Shape();
      PM.barLeft.graphics.beginFill(barcolor)
                .drawRect(0, 
                          (PM.doodleHeight - PM.barHeight)/2, 
                          PM.barWidth, 
                          PM.barHeight)
                .endFill();
      PM.stage.addChild(PM.barLeft);
    };

    PM.addBarRight = function(barcolor) {
      PM.barRight = new createjs.Shape();
      PM.barRight.graphics.beginFill(barcolor)
                          .drawRect(PM.doodleWidth, 
                                    (PM.doodleHeight - PM.barHeight)/2, 
                                    - PM.barWidth, 
                                    PM.barHeight)
                          .endFill();
      PM.stage.addChild(PM.barRight);
    };

    PM.addBall = function(ballcolor) {
      PM.ball = new createjs.Shape();
      PM.ball.graphics.beginFill(ballcolor).drawCircle(0, 0, PM.ballDiameter/2);
      PM.ball.x = PM.doodleWidth/2;
      PM.ball.y = PM.doodleHeight/2;
      PM.stage.addChild(PM.ball);
    };

    PM.makeThingsMove = function() {
      document.onkeydown = PM.handleKeyDown;
      document.onkeyup = PM.handleKeyUp;

      createjs.Ticker.setFPS(30);
      createjs.Ticker.addEventListener("tick", PM.stage);
      createjs.Ticker.addEventListener("tick", PM.tick);
    };

    PM.handleKeyDown = function(event) {
      if (!event) {
        var event = window.event;
      }
      switch(event.keyCode) {
        case 38: 
        case 87: PM.up = true; break;

        case 40: 
        case 83: PM.down = true; break;
      }
    };

    PM.handleKeyUp = function(event) {
      if (!event) {
        var event = window.event;
      }
      switch(event.keyCode) {
        case 38: 
        case 87: PM.up = false; break;

        case 40: 
        case 83: PM.down = false; break;
      }
    };

    PM.canMoveDown = function(){
      return PM.barRight.y < (PM.doodleHeight - PM.barHeight)/2;
    }

    PM.moveDown = function(){
      if(PM.canMoveDown){
        PM.barLeft.y -= PM.barMove;
        PM.barRight.y += PM.barMove;
      }
    };

    PM.tick = function() {
      
    //Handle movements of bars

      //When the ball is moving to the right
      if (PM.ballMoveX >= 0 && !PM.gameOver){
        createjs.Tween.get(PM.barLeft).to({alpha:0.3}, 400);
        createjs.Tween.get(PM.barRight).to({alpha:1}, 400);
        
        if (PM.up && PM.barRight.y > - (PM.doodleHeight - PM.barHeight)/2){
          PM.barLeft.y += PM.barMove;
          PM.barRight.y += - PM.barMove;
        }
        else if (PM.down){
          PM.moveDown();
        }
      }
      //When the ball is moving to the left
      if (PM.ballMoveX < 0 && !PM.gameOver){
        createjs.Tween.get(PM.barLeft).to({alpha:1}, 400);
        createjs.Tween.get(PM.barRight).to({alpha:0.3}, 400);
        if (PM.up && PM.barLeft.y > - (PM.doodleHeight - PM.barHeight)/2){
          PM.barLeft.y += - PM.barMove;
          PM.barRight.y += PM.barMove;
        }
        else if (PM.down && PM.barLeft.y < (PM.doodleHeight - PM.barHeight)/2){
          PM.barLeft.y += PM.barMove;
          PM.barRight.y += - PM.barMove;
        }
      }

    //Handle movements of the ball

      PM.ball.x += PM.ballMoveX;
      PM.ball.y += PM.ballMoveY;

      //When the ball touches the up/bottom edge
      if (PM.ball.y >= PM.doodleHeight - PM.ballDiameter/2 || PM.ball.y <= PM.ballDiameter/2){
        PM.ballMoveY = - PM.ballMoveY;
      }

      //When the ball touches the bars

        //When the ball is moving to the right
        if (PM.ballMoveX >= 0){
          if (PM.ball.x >= PM.doodleWidth - PM.ballDiameter/2 - PM.barWidth){
            if (PM.ball.y - PM.doodleHeight/2 >= PM.barRight.y - (PM.barHeight/2 + PM.ballDiameter/2)
             && PM.ball.y - PM.doodleHeight/2 <= PM.barRight.y + (PM.barHeight/2 + PM.ballDiameter/2)
             && !PM.gameOver) {
              PM.ballMoveX = - PM.ballMoveX;
            }
            else {
              PM.gameOver = true;
            }             
          }
        }
        
        //When the ball is moving to the left
        if (PM.ballMoveX < 0){
          if (PM.ball.x <= PM.ballDiameter/2 + PM.barWidth){
            if (PM.ball.y - PM.doodleHeight/2 >= PM.barLeft.y - (PM.barHeight/2 + PM.ballDiameter/2)
             && PM.ball.y - PM.doodleHeight/2 <= PM.barLeft.y + (PM.barHeight/2 + PM.ballDiameter/2)
             && !PM.gameOver) {
              PM.ballMoveX = - PM.ballMoveX;
            }
            else {
              PM.gameOver = true;
            }
          }
        }

    //Update the stage
      PM.stage.update();

    };

  </script>
</head>
<body onLoad="init();">
  <canvas id="doodle" width="500" height="300"></canvas>
</body>
</html>